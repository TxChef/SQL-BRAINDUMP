WITH IN_SUB
    AS (SELECT LOCHIERARCHY.LOCATION AS SUBSTATION, 
               LOCANCESTOR.LOCATION
        FROM (MAXIMO.LOCANCESTOR LOCANCESTOR
        INNER JOIN MAXIMO.LOCHIERARCHY LOCHIERARCHY
        ON (LOCANCESTOR.ANCESTOR = LOCHIERARCHY.LOCATION))  
        WHERE (LOCHIERARCHY.PARENT = 'SUBSTATIONS')
        ORDER BY SUBSTATION)

SELECT A.ASSETNUM,
       A.DESCRIPTION,
       A.LOCATION,
       B.ALNVALUE AS ASSET_OWNER,
       D.ALNVALUE AS LOCATION_OWNER 
FROM ASSET A
LEFT JOIN ASSETSPEC B
ON (A.ASSETNUM = B.ASSETNUM)
LEFT JOIN LOCATIONS C
ON (A.LOCATION = C.LOCATION)
LEFT JOIN LOCATIONSPEC D
ON (C.LOCATION = D.LOCATION)
LEFT JOIN IN_SUB E
ON (A.LOCATION = E.LOCATION)
WHERE ((A.LOCATION = E.LOCATION) AND (B.ASSETATTRID = 'OWNEDBY' AND D.ASSETATTRID = 'OWNEDBY') AND (B.ALNVALUE != D.ALNVALUE))



